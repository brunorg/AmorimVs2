function redirect(){window.location="planoDeEstudo.html"}function VerificaObjetivosCompletos(){for(var a,b=0;b<$(".roteiro_nome_tabela_selecionado").length+1;b++)if(a=!1,$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length>0)for(var c=1;c<$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length+1;c++)($(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_verde")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_laranja")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_branco"))&&(a=!0)}function SubstituirObjetivos(a){if($(a).empty(),$(a).attr("Cmpl","true"),void 0!=$(a).closest(".roteiro_nome_tabela_selecionado").attr("id")){var b=verificaProducaoExistente(1,$(a).closest(".roteiro_nome_tabela_selecionado").attr("id").substring(11)),c=verificaProducaoExistente(2,$(a).closest(".roteiro_nome_tabela_selecionado").attr("id").substring(11));$(a).append(""==b&&""==c?'<td id="producaoTD" style="color:white;font-style:italic;">Roteiro Completo e Corrigido</td>':""!=b&&""!=c?'<td id="producaoTD">'+b+" | "+c+"</td>":'<td id="producaoTD">'+b+" "+c+"</td>")}}function verificaProducaoExistente(a,b){var c=!1;if(1==a){for(var d=0;d<dataProducaoAluno.length;d++)dataProducaoAluno[d].roteiro.idroteiro==b&&dataProducaoAluno[d].aluno.idAluno==alunoID&&5==dataProducaoAluno[d].tipo.idtipoProducaoAluno&&(c=!0);if(!c)return'<a style="text-align:right;color:white" onclick="showUpload(1,'+b+');" href="#">Portifolio</a>'}else if(2==a)for(var d=0;d<dataProducaoAluno.length;d++)dataProducaoAluno[d].roteiro.idroteiro==b&&dataProducaoAluno[d].aluno.idAluno==alunoID&&4==dataProducaoAluno[d].tipo.idtipoProducaoAluno&&(c=!0);return""}function getUltimoPlanoEstudo(){var a;return $.ajax({url:path+"PlanoEstudo/aluno/"+alunoID,type:"GET",async:!1,dataType:"json",crossDomain:!0,success:function(b){a=b[0].idplanoEstudo}}),a}function abreCaixaFicha(a){$(".boxGlobal").css("display","block");var b=getData("FichaFinalizacao",a),c='<div id="caixaFicha"><a href="#" id="fecharCaixa"><img src="img/cancela_x.png" width="15" height="15" onclick="fecharCaixa()";/></a><a class="caixaTxt" id="txt1" target="_blank" href="'+b[0].local+'">Responder ficha de finaliza\xe7\xe3o</a><a class="caixaTxt" id="txt2" onclick="showUpload(2,'+a+');" href="#">Upload ficha de finaliza\xe7\xe3o</a></div>';$(".boxGlobal").html(c)}function fecharCaixa(){$(".boxGlobal").css("display","none")}function getAnoLetivo(a){var c,b=new Date;if("idAnoLetivo"==a)for(var d=getData("AnoLetivo",null),e=0;e<d.length;e++){var f=d[e].ano;f=f.split("-"),f[0]==b.getUTCFullYear()&&(c=d[e].idanoLetivo)}else"anoAnoLetivo"==a&&(c=b.getUTCFullYear());return c}function LoadRoteiro(){var a,b=getData("PlanejamentoRoteiro/status",alunoID);a="";for(var c=0;c<b.length;c++)-1==jQuery.inArray(b[c].objetivo.roteiro.idroteiro,IdsRoteiroPendente)&&(IdsRoteiroPendente.push(b[c].objetivo.roteiro.idroteiro),a="",a+="<div class='Content_Roteiro_Aluno_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="<div id='Roteiro_Id_"+b[c].objetivo.roteiro.idroteiro+"' class='roteiro_nome_tabela_anterior'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+b[c].objetivo.roteiro.idroteiro+")'>",a+=b[c].objetivo.roteiro.nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(b[c].objetivo.roteiro.idroteiro),a+="</div>",a+="<div class='box_rigth box_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(b[c].objetivo.roteiro.idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a));var d=getData("Roteiro/RoteiroAno/"+AnoEstudoAno,null);idRoteiro=new Array;for(var e=0;e<d.length;e++)IdRoteiro[e]=d[e].idroteiro,a="",a+="<div class='Content_Roteiro_Aluno_"+d[e].idroteiro+"' style='background:red'>",a+="<div id='Roteiro_Id_"+d[e].idroteiro+"' class='roteiro_nome_tabela_selecionado'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+d[e].idroteiro+")'>",a+=d[e].nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+d[e].idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(d[e].idroteiro),a+="</div>",a+="<div class='box_rigth box_"+d[e].idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(d[e].idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a);for(var f=getAnoLetivo("anoAnoLetivo"),g=getData("Roteiro/RoteiroAluno/"+alunoID+"/"+f,null),h=0;h<g.length;h++)IdRoteiro[e]=g[h].roteiro.idroteiro,jQuery.inArray(IdRoteiro[e],IdsRoteiroPendente)>-1&&$(".Content_Roteiro_Aluno_"+IdRoteiro[e]).remove(),a="",a+="<div class='Content_Roteiro_Aluno_"+g[h].roteiro.idroteiro+"'>",a+="<div id='Roteiro_Id_"+g[h].idroteiro+"' class='roteiro_nome_tabela_atribuido'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+g[h].roteiro.idroteiro+")'>",a+=g[h].roteiro.nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+g[h].roteiro.idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(g[h].roteiro.idroteiro),a+="</div>",a+="<div class='box_rigth box_"+g[h].roteiro.idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(g[h].roteiro.idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a);htmlPopUpContent='<div class="blackPainel"><div id="JanelaUploadPortifolio"><div class="Titulo_janela_upload">Upload de Portifolios<div class="close_upload_producao"></div></div><div id="foto"></div><div id="LegendaUpload">Aguardando Arquivo</div><form id="Cadastro_Producao_Aluno"><input type="hidden" id="id" name="id" /><input type="hidden" id="action" name="action" value="create" /><input type="hidden" id="Dados_Foto_Aluno" /><input type="file" id="Arquivo_Foto_Aluno" name="arquivo1" /><div class="campoConfirmaUpload"><input class="btn_submit" onclick="SalvarPortifolio()" type="button" value="" /></div></form></div></div>',$(".total").append(htmlPopUpContent),$("#Arquivo_Foto_Aluno").change(function(){$("#LegendaUpload").html("Arquivo Carregado")}),$(".close_upload_producao").click(function(){$(".blackPainel").hide(),$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo")}),LoadAtividade()}function SalvarPortifolio(){var c,a=new Date,b=getAnoLetivo("idAnoLetivo");localStorage.getItem("tamanhoArquivo")&&(c=localStorage.getItem("tamanhoArquivo")),"menor"==c?(""!=Arquivo&&void 0!=Arquivo?$.ajax({url:path+"ProducaoAluno/",type:"POST",crossDomain:!0,data:"action=create&anoLetivo="+b+"&texto="+$("#Roteiro_Id_"+roteiroAcionado+" .roteiro_nome_tabela_texto").html()+"&data="+a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate()+"&aluno="+getAlunoByUsuario(usuarioId)+"&tipo="+PortifolioVariavel+"&categoria=1&roteiro="+roteiroAcionado,beforeSend:function(){loading("inicial")},success:function(a){addFileTo(a),$(".blackPainel").hide()}}):mensagem("Insira um arquivo!","OK","bt_ok","alerta"),localStorage.setItem("tamanhoArquivo","")):(localStorage.setItem("tamanhoArquivo",""),mensagem("Tamanho m\xe1ximo permitido 30Mb!","OK","bt_ok","alerta"))}function addFileTo(a){var b=new FormData($("#Cadastro_Producao_Aluno")[0]);b.append("arquivo",Arquivo),$.ajax({url:path+"ProducaoAluno/upload/producaoAluno/arquivo/"+a,type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:b,success:function(){$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo"),dataProducaoAluno=getData("ProducaoAluno",null);var b=verificaProducaoExistente(1,roteiroAcionado),c=verificaProducaoExistente(2,roteiroAcionado);$(".QuadObj_"+roteiroAcionado+" #producaoTD").html(""==b&&""==c?'<font style="color:white;font-style: italic;">Roteiro Completo e Corrigido</font>':""!=b&&""!=c?b+" | "+c:b+" "+c),loading("final"),mensagem("Arquivo enviado com sucesso!","OK","bt_ok","sucesso")},error:function(){mensagem("Erro ao enviar arquivo!","OK","bt_ok","erro")}})}function showUpload(a,b){$(".boxGlobal").css("display","none"),1==a?($(".blackPainel").css("display","block"),PortifolioVariavel=5):2==a&&($(".blackPainel").css("display","block"),PortifolioVariavel=4),roteiroAcionado=b}function LoadAtividade(){var a,b;a=dataAtividade.length,b="";for(var d=0;d<a;d++)b="",b+="<div class='conteudo_do_roteiro ativ_"+dataAtividade[d].idatividade+"'>",b+="<table class='TbAtiv'>",b+="<tr>",b+="<td class='td_ativ'>"+dataAtividade[d].descricao,b+=""==dataAtividade[d].paginaLivro?";</td>":", p. "+dataAtividade[d].paginaLivro+";</td>",b+="</tr>",b+="</table>",b+="</div>",null!=dataAtividade[d].objetivo&&$(".Obj_"+dataAtividade[d].objetivo.idobjetivo).append(b)}function getRecursosDeRoteiro(a){for(var b="",c=0;c<dataRecursoAprendizagem.length;c++)if(dataRecursoAprendizagem[c].roteiro.idroteiro==a){switch(dataRecursoAprendizagem[c].tipoRecursoAprendizagem.idtipoRecursoAprendizagem){case 1:imagem="ic_livro2_peq.png";break;case 2:imagem="ic_video_peq";break;case 3:imagem="ic_audio_peq";break;case 4:imagem="ic_pgweb_peq";break;case 5:imagem="ic_jogo_peq";break;case 6:imagem="ic_foto_peq"}b+="<tr>",b+="<td class='titulo_recurso'>",b+="<img src='img/"+imagem+".png' width='15' height='auto' alt='"+dataRecursoAprendizagem[c].descricaoRecurso+"'/><a href='"+dataRecursoAprendizagem[c].link+"'>"+dataRecursoAprendizagem[c].nomeRecurso+"</a>",b+="</td>",b+="</tr>"}return b}function ApareceObj(a){var b,c=0;if(b=dataObjetivo.length,HtmlContent="",c=0,!$(".QuadObj_"+a).attr("Cmpl"))for(var e=0;e<b;e++)a==dataObjetivo[e].roteiro.idroteiro&&($(".Obj_"+dataObjetivo[e].idobjetivo).toggle(),0==c&&$(".box_"+a).toggle(),c=1)}function ApareceAtiv(a){var b;b=dataAtividade.length;for(var c=0;c<b;c++)null!=dataAtividade[c].objetivo&&a==dataAtividade[c].objetivo.idobjetivo&&$(".ativ_"+dataAtividade[c].idatividade).toggle()}function trocarObjetivoStatusBefore(a,b,c,d){"titulo_infos_roteiro_caixa_verde"==a.className?alert("P"):trocarObjetivoStatus(a,b,c,d)}function trocarObjetivoStatus(a,b,c,d){var e,f,g,h=new Date,i=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();"titulo_infos_roteiro_caixa_branco"==a.className?(e="laranja",g=1,f="create"):"titulo_infos_roteiro_caixa_laranja"==a.className?(e="verde",g=2,f="update"):"titulo_infos_roteiro_caixa_verde"==a.className&&(e="branco",f="deletar"),"titulo_infos_roteiro_caixa_verde_tk"!=a.className&&("create"==f?$.ajax({url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id=1&action=create&status="+g+"&dataStatusPlanejado="+i+"&objetivo="+b+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID,beforeSend:function(){loading("inicial")},success:function(){document.getElementById("td_roteiro_squr_"+b).className="td_roteiro_"+e,a.className="titulo_infos_roteiro_caixa_"+e,reSetObjetivo(b)},error:function(){alert("id=1&action=create&status="+g+"&dataStatusPlanejado="+i+"&objetivo="+b+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID)},complete:function(){loading("final")}}):"update"==f?$.ajax({url:path+"PlanejamentoRoteiro/StatusPlanejamento",type:"POST",crossDomain:!0,data:"id="+d+"&status=2",beforeSend:function(){loading("inicial")},success:function(){document.getElementById("td_roteiro_squr_"+b).className="td_roteiro_"+e,a.className="titulo_infos_roteiro_caixa_"+e,VerificaObjetivosCompletos()},error:function(){alert("N\xe3o modificado, verifique os campos.6.")},complete:function(){loading("final")}}):"deletar"==f&&mensagem("Deseja realmente excluir este planejamento?","Cancelar","bt_cancelar","confirm",b,d,"deletarPlanejamento"))}function deletarPlanejamento(a,b){$.ajax({type:"GET",crossDomain:!0,dataType:"text",async:!1,url:path+"PlanejamentoRoteiro/delete/"+b,statusCode:{405:function(){$("#td_objetivo_squr_"+a).removeClass("titulo_infos_roteiro_caixa_verde").addClass("titulo_infos_roteiro_caixa_branco"),$("#td_roteiro_squr_"+a).removeClass("td_roteiro_verde").addClass("td_roteiro_branco"),$("#boxMensagemGeral").css("display","none")}}})}function setObjetivoStatus(a,b,c,d,e){var f,g;"td_roteiro_branco"!=a.className&&"td_roteiro_verde_tk"!=a.className?("td_roteiro_branco"==a.className?(f="laranja",g=1):"td_roteiro_laranja"==a.className?(f="verde",g=2):"td_roteiro_verde"==a.className&&(f="laranja",g=1),$.ajax({url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id="+b+"&action=update&status="+g+"&objetivo="+c+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID,success:function(){a.className="td_roteiro_"+f,document.getElementById("td_objetivo_squr_"+c).className="titulo_infos_roteiro_caixa_"+f,VerificaObjetivosCompletos()},error:function(){alert("N\xe3o modificado, verifique os campos.2")}})):ApareceObj(e)}function _getObjetivos(a){var e,f,h,c=(getUltimoPlanoEstudo(),""),d="",i=!1;return $.ajax({url:path+"Objetivo/ObjetivoRoteiro/"+a,type:"GET",async:!1,crossDomain:!0,success:function(a){for(var b=0;b<a.length;b++)h=!1,$.ajax({url:path+"PlanejamentoRoteiro/alunoPendente/"+alunoID+"/"+a[b].idobjetivo,type:"GET",async:!1,crossDomain:!0,success:function(a){for(var b=0;b<a.length;b++)"1"==a[b].status&&PlanoEstudoSessionID==a[b].planoEstudo.idplanoEstudo?d="laranja":"2"==a[b].status&&PlanoEstudoSessionID==a[b].planoEstudo.idplanoEstudo?d="verde":"3"==a[b].status&&PlanoEstudoSessionID==a[b].planoEstudo.idplanoEstudo?d="verde_tk":"2"==a[b].status&&PlanoEstudoSessionID!=a[b].planoEstudo.idplanoEstudo?(d="verde",i=!0):d="3"==a[b].status&&PlanoEstudoSessionID!=a[b].planoEstudo.idplanoEstudo?"verde_tk":"branco",e=a[b].idplanejamentoRoteiro,f=a[b].planoEstudo.idplanoEstudo,h=!0}}),h||(d="branco"),c+='<div class="ObjLeft Obj_'+a[b].idobjetivo+'"><div class="titulo_infos_roteiro"><div class="td_roteiro_numero_tabela">'+a[b].numero+'</div><div class="td_titulo_tabela"><a onclick="ApareceAtiv('+a[b].idobjetivo+')">'+a[b].nome+'</a><div class="titulo_infos_roteiro_botoes"><div id="ObjStatus_'+a[b].idobjetivo+'" class="titulo_infos_roteiro_estrela">',0==i?c+='<div onclick="trocarObjetivoStatus(this,'+a[b].idobjetivo+","+PlanoEstudoSessionID+","+e+');" class="titulo_infos_roteiro_caixa_'+d+'" id="td_objetivo_squr_'+a[b].idobjetivo+'" >':(c+='<div class="titulo_infos_roteiro_caixa_'+d+'" id="td_objetivo_squr_'+a[b].idobjetivo+'" >',i=!1),c+="</div></div></div></div></div></div>",$(".QuadObj_"+a[b].roteiro.idroteiro).append('<td onclick="setObjetivoStatus(this,'+e+","+a[b].idobjetivo+","+f+","+a[b].roteiro.idroteiro+');" class="td_roteiro_'+d+'" id="td_roteiro_squr_'+a[b].idobjetivo+'">'+a[b].numero+"</td>")},error:function(){retorno="erro"}}),c}function getAlunoVariavelByAluno(){var a;return $.ajax({url:path+"AlunoVariavel/aluno/"+alunoID,type:"GET",async:!1,crossDomain:!0,success:function(b){AnoEstudoAno=b.anoEstudo.idanoEstudo,a=b},error:function(){a="erro"}}),a}function reSetObjetivo(a){var c,b=$("#td_roteiro_squr_"+a).parent().attr("class").substring(8);$.ajax({type:"GET",async:!1,crossDomain:!0,url:path+"PlanejamentoRoteiro/aluno/"+alunoID}).then(function(b){for(var d=0;d<b.length;d++)b[d].objetivo.idobjetivo==a&&(c=b[d].idplanejamentoRoteiro)}),$("#td_roteiro_squr_"+a).attr("onclick","setObjetivoStatus(this,"+c+","+a+",1,"+b+")"),$("#td_objetivo_squr_"+a).attr("onclick","trocarObjetivoStatus(this,"+a+","+PlanoEstudoSessionID+","+c+")")}var userID=usuarioId,alunoID=getAlunoByUsuario(userID),dataUsuario=getData("Usuario/aluno",alunoID),dataAlunoVariavel=getAlunoVariavelByAluno(),dataObjetivo=getData("Objetivo",null),dataAtividade=getData("Atividade",null),dataProducaoAluno=getData("ProducaoAluno",null),dataPlanejamentoRoteiro=getData("PlanejamentoRoteiro/aluno",alunoID);if(dataAlunoVariavel.constructor!==Array){var aux=dataAlunoVariavel;dataAlunoVariavel=new Array(1),dataAlunoVariavel[0]=aux}var dataRecursoAprendizagem=getData("RecursoAprendizagem",null),alunoVariavelID=getAlunoVariavelByAluno(),AnoEstudoAno,PlanoEstudoSessionID=getData("PlanoEstudo/aluno",alunoID);if(PlanoEstudoSessionID.constructor!==Array){var aux=PlanoEstudoSessionID;PlanoEstudoSessionID=new Array(1),PlanoEstudoSessionID[0]=aux}void 0!=PlanoEstudoSessionID[0]&&(PlanoEstudoSessionID=PlanoEstudoSessionID[0].idplanoEstudo);var PortifolioVariavel=0,roteiroAcionado=0,IdObjetivo=new Array,IdRoteiro=new Array,IdsRoteiroPendente=new Array;$(document).ready(function(){LoadRoteiro(),VerificaObjetivosCompletos(),0==PlanoEstudoSessionID&&"Aluno"==usuario&&mensagemF("Primeiro, precisa criar um Plano de Estudo","OK","bt_ok","alerta","redirect();"),GerarUpload($("#foto"),$("#Arquivo_Foto_Aluno"),$("#Dados_Foto_Aluno"))});
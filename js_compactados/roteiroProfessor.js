function redirect(){window.location="planoDeEstudo.html"}function getElementObjetivoId(a){for(var b=!1,c="",d=0;d<dataPlanejamentoRoteiro.length;d++)dataPlanejamentoRoteiro[d].objetivo.idobjetivo==a&&(0==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_branco' onclick='trocarObjetivoStatusBefore(this,"+a+","+PlanoEstudoSessionID+","+dataPlanejamentoRoteiro[d].idplanejamentoRoteiro+");'>"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>":1==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_laranja' onclick='trocarObjetivoStatusBefore(this,"+a+","+PlanoEstudoSessionID+","+dataPlanejamentoRoteiro[d].idplanejamentoRoteiro+");'>"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>":2==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_verde' onclick='trocarObjetivoStatusBefore(this,"+a+","+PlanoEstudoSessionID+","+dataPlanejamentoRoteiro[d].idplanejamentoRoteiro+");'>"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>":3==dataPlanejamentoRoteiro[d].status&&(c="<div class='titulo_infos_roteiro_caixa_verde_tk' >"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>"),alert("achou!"),b=!0),alert("acabo!");return b?c:"<div class='titulo_infos_roteiro_caixa_branco' onclick='trocarObjetivoStatusBefore(this,"+a+","+PlanoEstudoSessionID+",1);'></div>"}function VerificaObjetivosCompletos(){for(var a,b=0;b<$(".roteiro_nome_tabela_selecionado").length+1;b++){if(a=!1,$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length>0)for(var c=1;c<$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length+1;c++)($(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_verde")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_laranja")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_branco"))&&(a=!0);a||SubstituirObjetivos($(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").parent())}}function SubstituirObjetivos(a){if($(a).empty(),$(a).attr("Cmpl","true"),void 0!=$(a).closest(".roteiro_nome_tabela_selecionado").attr("id")){var b=verificaProducaoExistente(1,$(a).closest(".roteiro_nome_tabela_selecionado").attr("id").substring(11)),c=verificaProducaoExistente(2,$(a).closest(".roteiro_nome_tabela_selecionado").attr("id").substring(11));$(a).append(""==b&&""==c?'<td id="producaoTD" style="color:white;font-style:italic;">Roteiro Completo e Corrigido</td>':""!=b&&""!=c?'<td id="producaoTD">'+b+" | "+c+"</td>":'<td id="producaoTD">'+b+" "+c+"</td>")}}function verificaProducaoExistente(a,b){var c=!1;if(1==a){for(var d=0;d<dataProducaoAluno.length;d++)dataProducaoAluno[d].roteiro.idroteiro==b&&dataProducaoAluno[d].aluno.idAluno==alunoID&&5==dataProducaoAluno[d].tipo.idtipoProducaoAluno&&(c=!0);if(!c)return'<a style="text-align:right;color:white" onclick="showUpload(1,'+b+');" href="#">Portifolio</a>'}else if(2==a){for(var d=0;d<dataProducaoAluno.length;d++)dataProducaoAluno[d].roteiro.idroteiro==b&&dataProducaoAluno[d].aluno.idAluno==alunoID&&4==dataProducaoAluno[d].tipo.idtipoProducaoAluno&&(c=!0);if(!c)return'<a style="text-align:right;color:white" onclick="showUpload(2,'+b+');" href="#">Fichas de Finaliza\xe7\xe3o</a>'}return""}function LoadRoteiro(){$(".total").html("");var a,b,c=$("#anoEstudo").val();if("Selecione"!=c){var d=getData("Roteiro/RoteiroAno/"+c);a=d.length}if(b="",0!=a)for(var e=0;e<a;e++)b="",b+="<div class='Content_Roteiro_Aluno_"+d[e].idroteiro+"'>",b+="<div id='Roteiro_Id_"+d[e].idroteiro+"' class='roteiro_nome_tabela_selecionado'>",b+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+d[e].idroteiro+")'>",b+=d[e].nome,b+="</div>",b+="</div>",$(".total").append(b),b="",b+=_getObjetivos(d[e].idroteiro),b+="</div>",b+="<div class='box_rigth box_"+d[e].idroteiro+"'>",b+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",b+="<table class='tb_right'>",b+=getRecursosDeRoteiro(d[e].idroteiro),b+="</table>",b+="</div>",b+="<div style='clear: both;''> </div>",$(".total").append(b);htmlPopUpContent='<div class="blackPainel"><div id="JanelaUploadPortifolio"><div class="Titulo_janela_upload">Upload de Portifolios<div class="close_upload_producao"></div></div><div id="foto"></div><div id="LegendaUpload">Aguardando Arquivo</div><form id="Cadastro_Producao_Aluno"><input type="hidden" id="id" name="id" /><input type="hidden" id="action" name="action" value="create" /><input type="hidden" id="Dados_Foto_Aluno" /><input type="file" id="Arquivo_Foto_Aluno" name="arquivo1" /><div class="campoConfirmaUpload"><input class="btn_submit" onclick="SalvarPortifolio()" type="button" value="" /></div></form></div></div>',$(".total").append(htmlPopUpContent),$("#Arquivo_Foto_Aluno").change(function(){$("#LegendaUpload").html("Arquivo Carregado")}),$(".close_upload_producao").click(function(){$(".blackPainel").hide(),$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo")}),LoadAtividade()}function SalvarPortifolio(){var a=new Date;""!=Arquivo&&void 0!=Arquivo?$.ajax({url:path+"ProducaoAluno/",type:"POST",crossDomain:!0,dataType:"json",data:"action=create&anoLetivo=8&texto="+$("#Roteiro_Id_"+roteiroAcionado+" .roteiro_nome_tabela_texto").html()+"&data="+a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate()+"&aluno="+getAlunoByUsuario(usuarioId)+"&tipo="+PortifolioVariavel+"&categoria=3&roteiro="+roteiroAcionado,success:function(a){addFileTo(a),$(".blackPainel").hide()},error:function(){alert("N\xe3o modificado, verifique os campos3.")}}):alert("por favor, adicione um arquivo")}function addFileTo(a){var b=new FormData($("#Cadastro_Producao_Aluno")[0]);b.append("arquivo",Arquivo),$.ajax({url:path+"ProducaoAluno/upload/producaoAluno/arquivo/"+a,type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:b,success:function(){$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo"),dataProducaoAluno=getData("ProducaoAluno",null);var b=verificaProducaoExistente(1,roteiroAcionado),c=verificaProducaoExistente(2,roteiroAcionado);$(".QuadObj_"+roteiroAcionado+" #producaoTD").html(""==b&&""==c?'<font style="color:white;font-style: italic;">Roteiro Completo e Corrigido</font>':""!=b&&""!=c?b+" | "+c:b+" "+c)},error:function(){alert("N\xe3o modificado, verifique os campos.")}})}function showUpload(a,b){1==a?($(".blackPainel").css("display","block"),PortifolioVariavel=5):2==a&&($(".blackPainel").css("display","block"),PortifolioVariavel=4),roteiroAcionado=b}function LoadAtividade(){var a,b;a=dataAtividade.length,b="";for(var d=0;d<a;d++)b="",b+="<div class='conteudo_do_roteiro ativ_"+dataAtividade[d].idatividade+"'>",b+="<table class='TbAtiv'>",b+="<tr>",b+="<td class='td_ativ'>"+dataAtividade[d].descricao,b+=""==dataAtividade[d].paginaLivro?";</td>":", p. "+dataAtividade[d].paginaLivro+";</td>",b+="</tr>",b+="</table>",b+="</div>",null!=dataAtividade[d].objetivo&&$(".Obj_"+dataAtividade[d].objetivo.idobjetivo).append(b)}function getRecursosDeRoteiro(a){for(var b="",c=0;c<dataRecursoAprendizagem.length;c++)if(dataRecursoAprendizagem[c].roteiro.idroteiro==a){switch(dataRecursoAprendizagem[c].tipoRecursoAprendizagem.idtipoRecursoAprendizagem){case 1:imagem="ic_livro2_peq.png";break;case 2:imagem="ic_video_peq";break;case 3:imagem="ic_audio_peq";break;case 4:imagem="ic_pgweb_peq";break;case 5:imagem="ic_jogo_peq";break;case 6:imagem="ic_foto_peq"}b+="<tr>",b+="<td class='titulo_recurso'>",b+="<img src='img/"+imagem+".png' width='15' height='auto' alt='"+dataRecursoAprendizagem[c].descricaoRecurso+"'/><a href='"+dataRecursoAprendizagem[c].link+"'>"+dataRecursoAprendizagem[c].nomeRecurso+"</a>",b+="</td>",b+="</tr>"}return b}function ApareceObj(a){var b,c=0;if(b=dataObjetivo.length,HtmlContent="",c=0,!$(".QuadObj_"+a).attr("Cmpl"))for(var e=0;e<b;e++)a==dataObjetivo[e].roteiro.idroteiro&&($(".Obj_"+dataObjetivo[e].idobjetivo).toggle(),0==c&&$(".box_"+a).toggle(),c=1)}function ApareceAtiv(a){var b;b=dataAtividade.length;for(var c=0;c<b;c++)null!=dataAtividade[c].objetivo&&a==dataAtividade[c].objetivo.idobjetivo&&$(".ativ_"+dataAtividade[c].idatividade).toggle()}function trocarObjetivoStatusBefore(a,b,c,d){"titulo_infos_roteiro_caixa_verde"==a.className?alert("P"):trocarObjetivoStatus(a,b,c,d)}function trocarObjetivoStatus(a,b,c,d){var e,g,f=!1,h=new Date,i=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();"titulo_infos_roteiro_caixa_branco"==a.className?(e="laranja",g=1,f=!0):"titulo_infos_roteiro_caixa_laranja"==a.className?(e="verde",g=2):"titulo_infos_roteiro_caixa_verde"==a.className&&(e="laranja",g=1),"titulo_infos_roteiro_caixa_verde_tk"!=a.className&&$.ajax(f?{url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id=1&action=create&status="+g+"&dataStatusPlanejado="+i+"&objetivo="+b+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID,success:function(){document.getElementById("td_roteiro_squr_"+b).className="td_roteiro_"+e,a.className="titulo_infos_roteiro_caixa_"+e,reSetObjetivo(b)},error:function(){alert("id=1&action=create&status="+g+"&dataStatusPlanejado="+i+"&objetivo="+b+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID)}}:{url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id="+d+"&action=update&"+(1==g?"dataStatusPlanejado="+i+"&":"dataStatusEntregue="+i+"&")+"status="+g+"&objetivo="+b+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID,success:function(){document.getElementById("td_roteiro_squr_"+b).className="td_roteiro_"+e,a.className="titulo_infos_roteiro_caixa_"+e,VerificaObjetivosCompletos()},error:function(){alert("N\xe3o modificado, verifique os campos.6.")}})}function setObjetivoStatus(a,b,c,d,e){var f,g;"td_roteiro_branco"!=a.className&&"td_roteiro_verde_tk"!=a.className?("td_roteiro_branco"==a.className?(f="laranja",g=1):"td_roteiro_laranja"==a.className?(f="verde",g=2):"td_roteiro_verde"==a.className&&(f="laranja",g=1),$.ajax({url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id="+b+"&action=update&status="+g+"&objetivo="+c+"&planoEstudo="+PlanoEstudoSessionID+"&idAluno="+alunoID,success:function(){a.className="td_roteiro_"+f,document.getElementById("td_objetivo_squr_"+c).className="titulo_infos_roteiro_caixa_"+f,VerificaObjetivosCompletos()},error:function(){alert("N\xe3o modificado, verifique os campos.2")}})):ApareceObj(e)}function _getObjetivos(a){for(var d,e,b="",c="",g=0;g<dataObjetivo.length;g++)if(a==dataObjetivo[g].roteiro.idroteiro){for(var h=!1,i=0;i<dataPlanejamentoRoteiro.length;i++)dataObjetivo[g].idobjetivo==dataPlanejamentoRoteiro[i].objetivo.idobjetivo&&("0"==dataPlanejamentoRoteiro[i].status?c="branco":"1"==dataPlanejamentoRoteiro[i].status?c="laranja":"2"==dataPlanejamentoRoteiro[i].status?c="verde":"3"==dataPlanejamentoRoteiro[i].status&&(c="verde_tk"),d=dataPlanejamentoRoteiro[i].idplanejamentoRoteiro,e=dataPlanejamentoRoteiro[i].planoEstudo.idplanoEstudo,h=!0);h||(c="branco"),b+='<div class="ObjLeft Obj_'+dataObjetivo[g].idobjetivo+'"><div class="titulo_infos_roteiro"><div class="td_roteiro_numero_tabela">'+dataObjetivo[g].numero+'</div><div class="td_titulo_tabela"><a onclick="ApareceAtiv('+dataObjetivo[g].idobjetivo+')">'+dataObjetivo[g].nome+'</a><div class="titulo_infos_roteiro_botoes"><div id="ObjStatus_'+dataObjetivo[g].idobjetivo+'" class="titulo_infos_roteiro_estrela ocultar"><div onclick="trocarObjetivoStatus(this,'+dataObjetivo[g].idobjetivo+","+PlanoEstudoSessionID+","+d+');" class="titulo_infos_roteiro_caixa_'+c+'" id="td_objetivo_squr_'+dataObjetivo[g].idobjetivo+'" ></div></div></div></div></div></div>',$(".QuadObj_"+dataObjetivo[g].roteiro.idroteiro).append('<td onclick="setObjetivoStatus(this,'+d+","+dataObjetivo[g].idobjetivo+","+e+","+dataObjetivo[g].roteiro.idroteiro+');" class="td_roteiro_'+c+'" id="td_roteiro_squr_'+dataObjetivo[g].idobjetivo+'">'+dataObjetivo[g].numero+"</td>")}return b}function getAlunoVariavelByAluno(){for(var a=0;a<dataAlunoVariavel.length;a++)if("Aluno"==usuario){if(dataAlunoVariavel[a].aluno.idAluno==alunoID)return AnoEstudoID=dataAlunoVariavel[a].anoEstudo.idanoEstudo,dataAlunoVariavel[a].aluno.idAluno}else if("Professor"==usuario)return 0}function reSetObjetivo(a){var c,b=$("#td_roteiro_squr_"+a).parent().attr("class").substring(8);$.ajax({type:"GET",async:!1,crossDomain:!0,url:path+"PlanejamentoRoteiro/aluno/"+alunoID}).then(function(b){for(var d=0;d<b.length;d++)b[d].objetivo.idobjetivo==a&&(c=b[d].idplanejamentoRoteiro)}),$("#td_roteiro_squr_"+a).attr("onclick","setObjetivoStatus(this,"+c+","+a+",1,"+b+")"),$("#td_objetivo_squr_"+a).attr("onclick","trocarObjetivoStatus(this,"+a+","+PlanoEstudoSessionID+","+c+")")}var userID=usuarioId,alunoID=getAlunoByUsuario(userID),dataRoteiro=getData("Roteiro",null);if("Aluno"==usuario)var dataUsuario=getData("Usuario/aluno",alunoID),dataAlunoVariavel=getData("AlunoVariavel/aluno",alunoID);else var dataUsuario=0,dataAlunoVariavel=0;var dataObjetivo=getData("Objetivo",null),dataAtividade=getData("Atividade",null),dataProducaoAluno=getData("ProducaoAluno",null),dataPlanejamentoRoteiro=getData("PlanejamentoRoteiro/aluno",alunoID);if(dataPlanejamentoRoteiro.constructor!==Array){var aux=dataPlanejamentoRoteiro;dataPlanejamentoRoteiro=new Array(1),dataPlanejamentoRoteiro[0]=aux}if(dataAlunoVariavel.constructor!==Array){var aux=dataAlunoVariavel;dataAlunoVariavel=new Array(1),dataAlunoVariavel[0]=aux}var dataRecursoAprendizagem=getData("RecursoAprendizagem",null),alunoVariavelID=getAlunoVariavelByAluno(),AnoEstudoID,PlanoEstudoSessionID=getData("PlanoEstudo/aluno",alunoID);if(PlanoEstudoSessionID.constructor!==Array){var aux=PlanoEstudoSessionID;PlanoEstudoSessionID=new Array(1),PlanoEstudoSessionID[0]=aux}void 0!=PlanoEstudoSessionID[0]&&(PlanoEstudoSessionID=PlanoEstudoSessionID[0].idplanoEstudo);var PortifolioVariavel=0,roteiroAcionado=0,IdObjetivo=new Array,IdRoteiro=new Array;$(document).ready(function(){LoadRoteiro(),VerificaObjetivosCompletos();for(var a,b=getData("AnoEstudo",null),c=0;c<b.length;c++)a+="<option value='"+b[c].idanoEstudo+"'>"+b[c].ano+"\xba</option>";$("#anoEstudo").append(a),0==PlanoEstudoSessionID&&"Aluno"==usuario&&mensagemF("Primeiro, precisa criar um Plano de Estudo","OK","bt_ok","alerta","redirect();"),GerarUpload($("#foto"),$("#Arquivo_Foto_Aluno"),$("#Dados_Foto_Aluno"))});
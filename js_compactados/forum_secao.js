function getFile(a,b){var c;return $.ajax({type:"GET",async:!1,crossDomain:!0,url:path+""+b+"/"+a}).then(function(a){c=a.anexo}),c}function getPeriodoAluno(a){var b;void 0==a&&(a=IdAluno);for(var c=0;c<dataAlunoVariavel.length;c++)dataAlunoVariavel[c].aluno.idAluno==a&&(b=dataAlunoVariavel[c].periodo.periodo);return b}function getSerieAluno(a){var b;void 0==a&&(a=IdAluno);for(var c=0;c<dataAlunoVariavel.length;c++)dataAlunoVariavel[c].aluno.idAluno==a&&(b=dataAlunoVariavel[c].anoEstudo.ano);return b}function getResposta(a){for(var b="",c=0;c<dataForumResposta.length;c++)dataForumResposta[c].forumQuestao.idforumQuestao==a&&(void 0!=dataForumResposta[c].usuario.aluno?b+='<div class="Box_resposta_wrap" id="Qr_S_'+dataForumResposta[c].idforumResposta+'"> <div class="foto_aluno" style="background-image:url('+dataForumResposta[c].usuario.aluno.fotoAluno+')"> </div> <div class="box_resposta"> <div class="resposta_header"> <div class="nome_serie_aluno"> '+dataForumResposta[c].usuario.aluno.nome+" | "+getSerieAluno(dataForumResposta[c].usuario.aluno.idAluno)+"\xba S\xe9rie - "+getPeriodoAluno(dataForumResposta[c].usuario.aluno.idAluno)+" </div> "+(IdAluno==dataForumResposta[c].usuario.aluno.idAluno?'<div id="bt_fechar" onclick="deletarMensagemR('+dataForumResposta[c].idforumResposta+');" style="float:right"></div>':"")+'</div> <div class="msg"> '+dataForumResposta[c].resposta+" </div> </div>  </div>":void 0!=dataForumResposta[c].usuario.professor&&(b+='<div class="Box_resposta_wrap" id="Qr_S_'+dataForumResposta[c].idforumResposta+'"> <div class="foto_aluno" style="background-image:url('+dataForumResposta[c].usuario.professor.fotoProfessorFuncionario+')"> </div> <div class="box_resposta"> <div class="resposta_header"> <div class="nome_serie_aluno"> '+dataForumResposta[c].usuario.professor.nome+" | "+getSerieAluno(dataForumResposta[c].usuario.professor.idprofessorFuncionario)+"\xba S\xe9rie - "+getPeriodoAluno(dataForumResposta[c].usuario.professor.idprofessorFuncionario)+" </div> "+(IdAluno==dataForumResposta[c].usuario.professor.idprofessorFuncionario?'<div id="bt_fechar" onclick="deletarMensagemR('+dataForumResposta[c].idforumResposta+');" style="float:right"></div>':"")+'</div> <div class="msg"> '+dataForumResposta[c].resposta+" </div> </div> </div>"));return b}function getAlunoByUsuario(){for(var a=0;a<dataUsuario.length;a++)if(dataUsuario[a].idusuario==userID){if(null!=dataUsuario[a].aluno)return dataUsuario[a].aluno.idAluno;if(null!=dataUsuario[a].professor)return dataUsuario[a].professor.idprofessorFuncionario}}function getNomeQuestao(a){for(var b=0;b<dataForumQuestao.length;b++)if(dataForumQuestao[b].idforumQuestao==a)return dataForumQuestao[b].questao;return""}function deletarMensagemQ(a){$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"ForumResposta/",success:function(){}}).then(function(b){for(var c=0;c<b.length;c++)b[c].forumQuestao.idforumQuestao==a&&deletarMensagemR(b[c].idforumResposta);$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"ForumQuestao/delete/"+a,complete:function(){$("#Q_S_"+a).remove()}})})}function deletarMensagemR(a){$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"ForumResposta/delete/"+a,complete:function(){$("#Qr_S_"+a).remove()}})}var dataAluno=getData("Alunos",null),dataUsuario=getData("Usuario",null),dataRoteiro=getData("Roteiro",null),dataForumQuestao=getData("ForumQuestao",null),dataAlunoVariavel=getData("AlunoVariavel",null),dataForumResposta=getData("ForumResposta",null),dataProfessorFuncionario=getData("ProfessorFuncionario",null),dados,userID=usuarioId,IdAluno=getAlunoByUsuario(),IdRoteiro=base64_decode(GetURLParameter("IdRoteiro")),IdQuestao=base64_decode(GetURLParameter("IdQuestao")),unicoNomeRoteiro=getData("Roteiro",IdRoteiro);$(document).ready(function(){void 0==IdQuestao&&(FirstBoxhtml='<form id="frmCadastro_Questao"><div class="Box_perguntar_wrap"><div class="foto_aluno Me"> </div><div class="box_perguntar"><div class="perguntar_header"><div class="nome_serie_aluno">  </div></div><input type="hidden" name="id" id="id"  /> <input type="hidden" name="action" id="action"   value="create"/><input type="text" name="questao" id="questao" class="Pergunta_Input" /><input type="hidden" name="usuario" id="usuario" value="'+usuarioId+'"><input type="hidden" name="roteiro" id="roteiro" value="'+IdRoteiro+'" ><input type="file" name="anexo" id="anexo" size="45" style="display:none;" /></div><div><input id="bt_pergunta_enviar" type="submit" value="Enviar" /></div></div></form>',$("#FORUM").append(FirstBoxhtml)),$("#bt_pergunta_enviar").click(function(){var a=$("input.Pergunta_Input").val(),b=new Date,d=(b.getDay()+"/"+b.getMonth()+"/"+b.getFullYear()+" "+b.getHours()+":"+b.getMinutes(),"");if($(".Pergunta_Input").val().length>=10)for(var e=0;e<dataAluno.length;e++)dataAluno[e].idAluno==IdAluno&&"Aluno"==usuario?(dados=dataAluno[e],$("#frmCadastro_Questao").unbind("submit").on("submit",function(b){b.preventDefault();var c=new FormData($(this)[0]);$.ajax({url:path+"ForumQuestao/",type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:c,beforeSend:function(){loading("inicial")},success:function(b){return mensagem("Pergunta feita com sucesso!","OK","bt_ok","sucesso"),d=' <div class="Pergunta_Resposta_Container"> <div class="Box_pergunta_wrap"> <div class="foto_aluno" style="background-image:url('+dados.fotoAluno+')"> </div><div class="box_pergunta"> <div class="pergunta_header"> <div class="nome_serie_aluno"> '+dados.nome+" | "+getSerieAluno()+"\xba S\xe9rie - "+getPeriodoAluno()+" </div> "+(IdAluno==dados.idAluno?'<div id="bt_fechar" onclick="deletarMensagemQ('+b+')" style="float:right"></div>':"")+'</div> <div class="Pergunta"> </div> </div> </div> <div class="respostas R_aparecer"> </div> <div class="responder_ocultar bt_responder"> Responder </div>',console.log(d),$("#FORUM").append(d),$("#FORUM .Pergunta_Resposta_Container").last().attr("id","Q_S_"+b),$("#FORUM .Pergunta_Resposta_Container").last().find("a").attr("href",""+getFile(b,"ForumQuestao")),$("input.Pergunta_Input").val(""),$(".Pergunta_Resposta_Container:last-child .Pergunta").html(a),!1},error:function(){},complete:function(){loading("final")}})})):(void 0!=dataProfessorFuncionario[e]?dataProfessorFuncionario[e].idprofessorFuncionario!=IdAluno||"Professor"!=usuario:1)||(d=' <div class="Pergunta_Resposta_Container" id="Q_S_0"> <div class="Box_pergunta_wrap"> <div class="foto_aluno" style="background-image:url('+dataProfessorFuncionario[e].fotoProfessorFuncionario+')"> </div> <div class="box_pergunta"> <div class="pergunta_header"> <div class="nome_serie_aluno"> '+dataProfessorFuncionario[e].nome+" - Professor </div> "+(IdAluno==dataProfessorFuncionario[e].idprofessorFuncionario?'<div id="bt_fechar" style="float:right"></div>':"")+'</div> <div class="Pergunta"> </div> </div> </div> <div class="respostas R_aparecer"> </div> <div class="responder_ocultar bt_responder"> Responder </div>',$("#frmCadastro_Questao").unbind("submit").on("submit",function(b){b.preventDefault();var c=new FormData($(this)[0]);$.ajax({url:path+"ForumQuestao/",type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:c,beforeSend:function(){loading("inicial")},success:function(b){mensagem("Pergunta feita com sucesso!","OK","bt_ok","sucesso"),$("#FORUM").append(d),$("#FORUM .Pergunta_Resposta_Container").last().attr("id","Q_S_"+b),$("#FORUM .Pergunta_Resposta_Container").last().attr("onclick","deletarMensagemQ("+b+")"),$("#FORUM .Pergunta_Resposta_Container").last().find("a").attr("href",""+getFile(b,"ForumQuestao")),$("input.Pergunta_Input").val(""),$(".Pergunta_Resposta_Container:last-child .Pergunta").html(a)},error:function(){alert("N\xe3o modificado, verifique os campos.")},complete:function(){loading("final")}}),$("#loader").remove()}));else $("#frmCadastro_Questao").unbind("submit").on("submit",function(a){a.preventDefault()}),mensagem("Sua pergunta est\xe1 muito curta!","OK","bt_ok","erro"),$("#loader").remove()}),$(document).on("click",".bt_responder",function(){$(".selecionado .respostas").show(),$(".selecionado .mostrar_respostas").removeClass("mostrar_respostas").addClass("ocultar_respostas").html("ocultar respostas");for(var a=0;a<dataAluno.length;a++){var b=$(".selecionado").attr("id");b=b.split("_"),dataAluno[a].idAluno==IdAluno&&"Aluno"==usuario?(htmlResposta='<form class="frmCadastro_Resposta" id="Qr_S_0"><div class="Box_resposta_wrap"> <div class="foto_aluno" style="background-image:url('+dataAluno[a].fotoAluno+')"> </div> <div class="box_resposta"> <div class="resposta_header"> <div class="nome_serie_aluno"> '+dataAluno[a].nome+" | "+getSerieAluno()+"\xba S\xe9rie - "+getPeriodoAluno()+' </div> </div> <input type="hidden" name="action" id="action" value="create"> </input> <input class="msg_input" name="resposta" id="resposta" type="text" placeholder="Escreva seu coment\xe1rio."> </input> <input type="file" name="anexo" id="anexo" size="45" style="display:none;" /><input type="hidden" name="usuario" id="usuario" value="'+usuarioId+'"> </input> <input type="hidden" name="forumQuestao" id="forumQuestao" value="'+b[2]+'"> </input> </div> <div class="bt_resposta_enviar_cancelar"><input type="submit" class="enviar" value="enviar"></input> | <span class="cancelar"> cancelar </span> </div> </div> </div></form>',$(".selecionado .respostas").append(htmlResposta),$(".selecionado .responder_ocultar").remove()):(null!=dataProfessorFuncionario[a]?dataProfessorFuncionario[a].idprofessorFuncionario!=IdAluno||"Professor"!=usuario:1)||(htmlResposta='<form class="frmCadastro_Resposta" id="Qr_S_0"><div class="Box_resposta_wrap"> <div class="foto_aluno" style="background-image:url('+dataProfessorFuncionario[a].fotoProfessorFuncionario+')"> </div> <div class="box_resposta"> <div class="resposta_header"> <div class="nome_serie_aluno"> '+dataProfessorFuncionario[a].nome+' - Professor </div> </div> <input type="hidden" name="action" id="action" value="create"> </input> <input class="msg_input" name="resposta" id="resposta" type="text" placeholder="Escreva seu coment\xe1rio."> </input> <input type="file" name="anexo" id="anexo" size="45" style="display:none;" /><input type="hidden" name="usuario" id="usuario" value="'+usuarioId+'"> </input> <input type="hidden" name="forumQuestao" id="forumQuestao" value="'+b[2]+'"> </input> </div> <div class="bt_resposta_enviar_cancelar"><input type="submit" class="enviar" value="enviar"></input> | <span class="cancelar"> cancelar </span> </div> </div> </div></form>',$(".selecionado .respostas").append(htmlResposta),$(".selecionado .responder_ocultar").remove())}}),$(document).on("click","span.cancelar",function(){$(".selecionado .respostas .Box_resposta_wrap").last("Box_resposta_wrap").remove(),$(".selecionado").append('<div class="responder_ocultar"> <span class="bt_responder"> Responder </span> | <span class="ocultar_respostas"> ocultar respostas </span> </div>')}),$(document).on("click","span.ocultar_respostas",function(){$(".selecionado .respostas").hide(),$(".selecionado .ocultar_respostas").removeClass("ocultar_respostas").addClass("mostrar_respostas").html("mostrar respostas")}),$(document).on("click","span.mostrar_respostas",function(){$(".selecionado .respostas").show(),$(".selecionado .mostrar_respostas").removeClass("mostrar_respostas").addClass("ocultar_respostas").html("ocultar respostas")}),$("body").on("click",".Pergunta_Resposta_Container",function(){$("div.Pergunta_Resposta_Container").removeClass("selecionado"),$(this).removeClass("selecionado").addClass("selecionado")}),$.ajax({type:"GET",crossDomain:!0,url:path+"ForumQuestao"}).then(function(a){for(var b=0;b<a.length;b++){if(a[b].roteiro.idroteiro==IdRoteiro){var c=getResposta(a[b].idforumQuestao);(IdQuestao==a[b].idforumQuestao||void 0==IdQuestao)&&(void 0!=a[b].usuario.aluno?HtmlQuestoes='<div class="Pergunta_Resposta_Container" id="Q_S_'+a[b].idforumQuestao+'"> <div class="Box_pergunta_wrap"> <div class="foto_aluno" style="background-image:url('+a[b].usuario.aluno.fotoAluno+')"> </div> <div class="box_pergunta"><div class="pergunta_header"><div class="nome_serie_aluno">'+a[b].usuario.aluno.nome+" | "+getSerieAluno(a[b].usuario.aluno.idAluno)+"\xba S\xe9rie - "+getPeriodoAluno(a[b].usuario.aluno.idAluno)+" </div> "+(IdAluno==a[b].usuario.aluno.idAluno?'<div id="bt_fechar" onclick="deletarMensagemQ('+a[b].idforumQuestao+');" style="float:right"></div>':"")+'</div> <div class="Pergunta"> '+a[b].questao+' </div> </div> </div> <div class="respostas'+(""!=c?"":" R_aparecer")+'"> '+c+" </div> "+(""!=c?'<div class="responder_ocultar"> <span class="bt_responder"> Responder </span> | <span class="mostrar_respostas"> mostrar respostas </span> </div>':'<div class="responder_ocultar bt_responder"> Responder </div>'):void 0!=a[b].usuario.professor&&(HtmlQuestoes='<div class="Pergunta_Resposta_Container" id="Q_S_'+a[b].idforumQuestao+'"> <div class="Box_pergunta_wrap"> <div class="foto_aluno" style="background-image:url('+a[b].usuario.professor.fotoProfessorFuncionario+')"> </div> <div class="box_pergunta"><div class="pergunta_header"><div class="nome_serie_aluno">'+a[b].usuario.professor.nome+" | "+a[b].usuario.perfil.perfil+" </div> "+(IdAluno==a[b].usuario.professor.idprofessorFuncionario?'<div id="bt_fechar" onclick="deletarMensagemQ('+a[b].idforumQuestao+');" style="float:right"></div>':"")+'</div> <div class="Pergunta"> '+a[b].questao+' </div> </div> </div> <div class="respostas'+(""!=c?"":" R_aparecer")+'"> '+c+" </div> "+(""!=c?'<div class="responder_ocultar"> <span class="bt_responder"> Responder </span> | <span class="mostrar_respostas"> mostrar respostas </span> </div>':'<div class="responder_ocultar bt_responder"> Responder </div>')),$("#FORUM").append(HtmlQuestoes))}$("#Secao_forum_Titulo").html("<a id='Bk_Rot' href='forumSecao.html?IdRoteiro="+base64_encode(""+IdRoteiro)+"'>"+unicoNomeRoteiro.nome+"</a>"+(void 0==IdQuestao?"":" > "+getNomeQuestao(IdQuestao)))}}),$(document).on("click",".frmCadastro_Resposta input.enviar",function(){if(""!=$(".Pergunta_Resposta_Container.selecionado .msg_input").val()){{var b=($(".Pergunta_Resposta_Container.selecionado input").val(),new Date);b.getDay()+"/"+b.getMonth()+"/"+b.getFullYear()+" "+b.getHours()+":"+b.getMinutes()}$(".Pergunta_Resposta_Container.selecionado .Box_resposta_wrap").css("padding","20px"),$(".Pergunta_Resposta_Container.selecionado").append('<div class="responder_ocultar"> <span class="bt_responder"> Responder </span> | <span class="ocultar_respostas"> ocultar respostas </span> </div>'),$(this).parent().parent().parent().unbind("submit").on("submit",function(a){a.preventDefault();var b=$(this).find(".resposta_header"),c=new FormData($(this)[0]);$.ajax({url:path+"ForumResposta/",type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:c,success:function(a){$(".bt_resposta_enviar_cancelar").remove(),$(b.parent()).find("#resposta").attr("disabled","true"),$(b.parent()).find("#resposta").attr("class","msg"),$(b).append('<div id="bt_fechar" onclick="deletarMensagemR('+a+');" style="float:right"></div>'),$("#Qr_S_0").attr("id","Qr_S_"+a)},error:function(){}})})}});for(var a=0;a<dataAluno.length;a++)dataAluno[a].idAluno==IdAluno&&"Aluno"==usuario?($(".foto_aluno").css("background-image","url("+dataAluno[a].fotoAluno+")"),$(".nome_serie_aluno").html(dataAluno[a].nome+" | "+getSerieAluno()+"\xba S\xe9rie - "+getPeriodoAluno())):(void 0!=dataProfessorFuncionario[a]?dataProfessorFuncionario[a].idprofessorFuncionario!=IdAluno||"Professor"!=usuario:1)||($(".foto_aluno").css("background-image","url("+dataProfessorFuncionario[a].fotoProfessorFuncionario+")"),$(".nome_serie_aluno").html(dataProfessorFuncionario[a].nome+" - Professor"))});
function redirect(){window.location="planoDeEstudo.html"}function getElementObjetivoId(a){for(var b=!1,c="",d=0;d<dataPlanejamentoRoteiro.length;d++)dataPlanejamentoRoteiro[d].objetivo.idobjetivo==a&&(0==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_branco' </div>":1==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_laranja'>"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>":2==dataPlanejamentoRoteiro[d].status?c="<div class='titulo_infos_roteiro_caixa_verde'>"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>":3==dataPlanejamentoRoteiro[d].status&&(c="<div class='titulo_infos_roteiro_caixa_verde_tk' >"+dataPlanejamentoRoteiro[d].objetivo.numero+"</div>"),b=!0);return b?c:"<div class='titulo_infos_roteiro_caixa_branco' ></div>"}function VerificaObjetivosCompletos(){for(var a,b=0;b<$(".roteiro_nome_tabela_selecionado").length;b++){if(a=!1,$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length>0)for(var c=1;c<$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").length+1;c++)($(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_verde")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_laranja")||$(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td:nth-child("+c+")").hasClass("td_roteiro_branco"))&&(a=!0);a||SubstituirObjetivos($(document.getElementsByClassName("roteiro_nome_tabela_selecionado")[b]).find("td").parent())}}function SubstituirObjetivos(a){var b=$(a).closest(".roteiro_nome_tabela_selecionado").attr("id").substring(11);if($(a).empty(),$(a).attr("Cmpl","true"),void 0!=$(a).closest(".roteiro_nome_tabela_selecionado").attr("id")){var c=verificaProducaoExistente(5,b),d=verificaProducaoExistente(4,b);if(HtmlContent="",HtmlContent+='<td id="producaoTD">',""==c)HtmlContent+='<a style="text-align:right;color:white" onclick="showUpload(1,'+b+');" href="#"><div class="botoesPortfolio">Portf\xf3lio </div></a>';else switch(c.status){case 1:HtmlContent+='<div class="botoesPortfolio">Portf\xf3lio<div class="icone entregue"></div></div>';break;case 2:HtmlContent+='<div class="botoesPortfolio">Portf\xf3lio<div class="icone observacao" onclick="responderObservacao('+c.mensagens.idmensagens+')"></div></div>';break;case 3:HtmlContent+='<div class="botoesPortfolio">Portf\xf3lio<div class="icone corrigido"></div></div>'}var e;if($.ajax({url:path+"FichaFinalizacao/"+b,async:!1,crossDomain:!0,type:"GET",success:function(a){e=a}}),""==d&&e.length>0)HtmlContent+='<a href="#" style="text-align:right;color:white" onclick="abreCaixaFicha('+b+');"><div class="botoesPortfolio">Ficha de Finaliza\xe7\xe3o | </div></a>';else if(e.length>0)switch(d.status){case 1:HtmlContent+='<div class="botoesPortfolio">Ficha de Finaliza\xe7\xe3o | <div class="icone entregue"></div></div>';break;case 2:HtmlContent+='<div class="botoesPortfolio">Ficha de Finaliza\xe7\xe3o | <div class="icone observacao" onclick="responderObservacao('+d.mensagens.idmensagens+')"></div></div>';break;case 3:HtmlContent+='<div class="botoesPortfolio"> Ficha de Finaliza\xe7\xe3o | <div class="icone corrigido"></div></div>'}HtmlContent+="</td>",$(a).append(HtmlContent)}}function verificaProducaoExistente(a,b){var c;return $.ajax({url:path+"ProducaoAluno/Filtos/"+alunoID+"/"+a+"/"+b,async:!1,crossDomain:!0,type:"GET",success:function(a){c=a}}),c.length>0?c[0]:""}function abreCaixaFicha(a){$(".boxGlobal").css("display","block");var b=getData("FichaFinalizacao",a),c='<div id="caixaFicha"><a href="#" id="fecharCaixa"><img src="img/cancela_x.png" width="15" height="15" onclick="fecharCaixa()";/></a><a class="caixaTxt" id="txt1" target="_blank" href="'+b[0].local+'">Responder ficha de finaliza\xe7\xe3o</a><a class="caixaTxt" id="txt2" onclick="showUpload(2,'+a+');" href="#">Upload ficha de finaliza\xe7\xe3o</a></div>';$(".boxGlobal").html(c)}function fecharCaixa(){$(".boxGlobal").css("display","none")}function getAnoLetivo(a){var c,b=new Date;if("idAnoLetivo"==a)for(var d=getData("AnoLetivo",null),e=0;e<d.length;e++){var f=d[e].ano;f=f.split("-"),f[0]==b.getUTCFullYear()&&(c=d[e].idanoLetivo)}else"anoAnoLetivo"==a&&(c=b.getUTCFullYear());return c}function LoadRoteiro(){var a,b=getData("PlanejamentoRoteiro/status",alunoID);a="";for(var c=0;c<b.length;c++)-1==jQuery.inArray(b[c].objetivo.roteiro.idroteiro,IdsRoteiroPendente)&&(IdsRoteiroPendente.push(b[c].objetivo.roteiro.idroteiro),a="",a+="<div class='Content_Roteiro_Aluno_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="<div id='Roteiro_Id_"+b[c].objetivo.roteiro.idroteiro+"' class='roteiro_nome_tabela_anterior'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+b[c].objetivo.roteiro.idroteiro+")'>",a+=b[c].objetivo.roteiro.nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(b[c].objetivo.roteiro.idroteiro),a+="</div>",a+="<div class='box_rigth box_"+b[c].objetivo.roteiro.idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(b[c].objetivo.roteiro.idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a));var d=getData("Roteiro/RoteiroAno/"+AnoEstudoAno,null);idRoteiro=new Array;for(var e=0;e<d.length;e++)IdRoteiro[e]=d[e].idroteiro,a="",a+="<div class='Content_Roteiro_Aluno_"+d[e].idroteiro+"' style='background:red'>",a+="<div id='Roteiro_Id_"+d[e].idroteiro+"' class='roteiro_nome_tabela_selecionado'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+d[e].idroteiro+")'>",a+=d[e].nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+d[e].idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(d[e].idroteiro),a+="</div>",a+="<div class='box_rigth box_"+d[e].idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(d[e].idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a);for(var f=getAnoLetivo("anoAnoLetivo"),g=getData("Roteiro/RoteiroAluno/"+alunoID+"/"+f,null),h=0;h<g.length;h++)IdRoteiro[e]=g[h].roteiro.idroteiro,jQuery.inArray(IdRoteiro[e],IdsRoteiroPendente)>-1&&$(".Content_Roteiro_Aluno_"+IdRoteiro[e]).remove(),a="",a+="<div class='Content_Roteiro_Aluno_"+g[h].roteiro.idroteiro+"'>",a+="<div id='Roteiro_Id_"+g[h].idroteiro+"' class='roteiro_nome_tabela_atribuido'>",a+="<div class='roteiro_nome_tabela_texto' onclick='ApareceObj("+g[h].roteiro.idroteiro+")'>",a+=g[h].roteiro.nome,a+="</div>",a+="<div class='tabela_colorida_roteiro'>",a+="<table>",a+="<tr class='QuadObj_"+g[h].roteiro.idroteiro+"'>",a+="</tr>",a+="</table>",a+="</div>",a+="</div>",$(".total").append(a),a="",a+=_getObjetivos(g[h].roteiro.idroteiro),a+="</div>",a+="<div class='box_rigth box_"+g[h].roteiro.idroteiro+"'>",a+="<div class='td_titulo_recurso'>Recursos de aprendizagem</div>",a+="<table class='tb_right'>",a+=getRecursosDeRoteiro(g[h].roteiro.idroteiro),a+="</table>",a+="</div>",a+="<div style='clear: both;''> </div>",$(".total").append(a);htmlPopUpContent='<div class="blackPainel"><div id="JanelaUploadPortifolio"><div class="Titulo_janela_upload">Upload de Portifolios<div class="close_upload_producao"></div></div><div id="foto"></div><div id="LegendaUpload">Aguardando Arquivo</div><form id="Cadastro_Producao_Aluno"><input type="hidden" id="id" name="id" /><input type="hidden" id="action" name="action" value="create" /><input type="hidden" id="Dados_Foto_Aluno" /><input type="file" id="Arquivo_Foto_Aluno" name="arquivo1" /><div class="campoConfirmaUpload"><input class="btn_submit" onclick="SalvarPortifolio()" type="button" value="" /></div></form></div></div>',$(".total").append(htmlPopUpContent),$("#Arquivo_Foto_Aluno").change(function(){$("#LegendaUpload").html("Arquivo Carregado")}),$(".close_upload_producao").click(function(){$(".blackPainel").hide(),$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo")}),LoadAtividade()}function SalvarPortifolio(){var c,a=new Date,b=getAnoLetivo("idAnoLetivo");localStorage.getItem("tamanhoArquivo")&&(c=localStorage.getItem("tamanhoArquivo")),"menor"==c?(""!=Arquivo&&void 0!=Arquivo?$.ajax({url:path+"ProducaoAluno/",type:"POST",crossDomain:!0,data:"action=create&anoLetivo="+b+"&texto="+$("#Roteiro_Id_"+roteiroAcionado+" .roteiro_nome_tabela_texto").html()+"&data="+a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate()+"&aluno="+getAlunoByUsuario(usuarioId)+"&tipo="+PortifolioVariavel+"&categoria=1&roteiro="+roteiroAcionado,beforeSend:function(){loading("inicial")},success:function(a){addFileTo(a,PortifolioVariavel),$(".blackPainel").hide()},complete:function(){loading("final")}}):mensagem("Insira um arquivo!","OK","bt_ok","alerta"),localStorage.setItem("tamanhoArquivo","")):(localStorage.setItem("tamanhoArquivo",""),mensagem("Tamanho m\xe1ximo permitido 30Mb!","OK","bt_ok","alerta"))}function addFileTo(a,b){var c=new FormData($("#Cadastro_Producao_Aluno")[0]);c.append("arquivo",Arquivo),$.ajax({url:path+"ProducaoAluno/upload/producaoAluno/arquivo/"+a,type:"POST",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,data:c,beforeSend:function(){loading("inicial")},success:function(){$("#Dados_Foto_Aluno").val(""),$("#Arquivo_Foto_Aluno").val(""),$("#foto").css("background-image","url(img/foto.png)"),$("#LegendaUpload").html("Aguardando Arquivo"),$(".QuadObj_"+roteiroAcionado+" .botoesPortfolio")[5==b?0:1].innerHTML=(5==b?"Portf\xf3lio":"Ficha de Finaliza\xe7\xe3o")+"<div class='icone entregue'></div>",$(".QuadObj_"+roteiroAcionado+" .icone")[5==b?0:1].parentNode.parentNode.onclick="",$(".QuadObj_"+roteiroAcionado+" .icone")[5==b?0:1].parentNode.parentNode.style.cursor="default",mensagem("Arquivo enviado com sucesso!","OK","bt_ok","sucesso")},error:function(){mensagem("Erro ao enviar arquivo!","OK","bt_ok","erro")},complete:function(){loading("final")}})}function showUpload(a,b){$(".boxGlobal").css("display","none"),1==a?($(".blackPainel").css("display","block"),PortifolioVariavel=5):2==a&&($(".blackPainel").css("display","block"),PortifolioVariavel=4),roteiroAcionado=b}function LoadAtividade(){var a,b;a=dataAtividade.length,b="";for(var d=0;d<a;d++)b="",b+="<div class='conteudo_do_roteiro ativ_"+dataAtividade[d].idatividade+"'>",b+="<table class='TbAtiv'>",b+="<tr>",b+="<td class='td_ativ'>"+dataAtividade[d].descricao,b+=""==dataAtividade[d].paginaLivro?";</td>":", p. "+dataAtividade[d].paginaLivro+";</td>",b+="</tr>",b+="</table>",b+="</div>",null!=dataAtividade[d].objetivo&&$(".Obj_"+dataAtividade[d].objetivo.idobjetivo).append(b)}function getRecursosDeRoteiro(a){for(var b="",c=0;c<dataRecursoAprendizagem.length;c++)if(dataRecursoAprendizagem[c].roteiro.idroteiro==a){switch(dataRecursoAprendizagem[c].tipoRecursoAprendizagem.idtipoRecursoAprendizagem){case 1:imagem="ic_livro2_peq.png";break;case 2:imagem="ic_video_peq";break;case 3:imagem="ic_audio_peq";break;case 4:imagem="ic_pgweb_peq";break;case 5:imagem="ic_jogo_peq";break;case 6:imagem="ic_foto_peq"}b+="<tr>",b+="<td class='titulo_recurso'>",b+="<img src='img/"+imagem+".png' width='15' height='auto' alt='"+dataRecursoAprendizagem[c].descricaoRecurso+"'/><a href='"+dataRecursoAprendizagem[c].link+"'>"+dataRecursoAprendizagem[c].nomeRecurso+"</a>",b+="</td>",b+="</tr>"}return b}function ApareceObj(a){var b,c=0;if(b=dataObjetivo.length,HtmlContent="",c=0,!$(".QuadObj_"+a).attr("Cmpl"))for(var e=0;e<b;e++)a==dataObjetivo[e].roteiro.idroteiro&&($(".Obj_"+dataObjetivo[e].idobjetivo).toggle(),0==c&&$(".box_"+a).toggle(),c=1)}function ApareceAtiv(a){var b;b=dataAtividade.length;for(var c=0;c<b;c++)null!=dataAtividade[c].objetivo&&a==dataAtividade[c].objetivo.idobjetivo&&$(".ativ_"+dataAtividade[c].idatividade).toggle()}function _getObjetivos(a){for(var d,b="",c="",e=getData("PlanoEstudo/aluno",alunoID),g=0;g<dataObjetivo.length;g++)if(a==dataObjetivo[g].roteiro.idroteiro){for(var h=!1,i=0;i<dataPlanejamentoRoteiro.length;i++)dataObjetivo[g].idobjetivo==dataPlanejamentoRoteiro[i].objetivo.idobjetivo&&("0"==dataPlanejamentoRoteiro[i].status||"1"==dataPlanejamentoRoteiro[i].status&&e[0].idplanoEstudo!=dataPlanejamentoRoteiro[i].planoEstudo.idplanoEstudo?c="branco":"1"==dataPlanejamentoRoteiro[i].status&&e[0].idplanoEstudo==dataPlanejamentoRoteiro[i].planoEstudo.idplanoEstudo?c="laranja":"2"==dataPlanejamentoRoteiro[i].status?c="verde":"3"==dataPlanejamentoRoteiro[i].status&&(c="verde_tk"),d=dataPlanejamentoRoteiro[i].idplanejamentoRoteiro,IDplanoEstudo=dataPlanejamentoRoteiro[i].planoEstudo.idplanoEstudo,h=!0);h||(c="branco"),b+='<div class="ObjLeft Obj_'+dataObjetivo[g].idobjetivo+'"><div class="titulo_infos_roteiro"><div class="td_roteiro_numero_tabela">'+dataObjetivo[g].numero+'</div><div class="td_titulo_tabela"><a onclick="ApareceAtiv('+dataObjetivo[g].idobjetivo+')">'+dataObjetivo[g].nome+'</a><div class="titulo_infos_roteiro_botoes"><div id="ObjStatus_'+dataObjetivo[g].idobjetivo+'" class="titulo_infos_roteiro_estrela"><div class="titulo_infos_roteiro_caixa_'+c+'" id="td_objetivo_squr_'+dataObjetivo[g].idobjetivo+'" ></div></div></div></div></div></div>',$(".QuadObj_"+dataObjetivo[g].roteiro.idroteiro).append('<td class="td_roteiro_'+c+'" id="td_roteiro_squr_'+dataObjetivo[g].idobjetivo+'">'+dataObjetivo[g].numero+"</td>")}return b}function getAlunoVariavelByAluno(){for(var a=0;a<dataAlunoVariavel.length;a++)if("Aluno"==usuario){if(dataAlunoVariavel[a].aluno.idAluno==alunoID)return AnoEstudoAno=dataAlunoVariavel[a].anoEstudo.idanoEstudo,dataAlunoVariavel[a].aluno.idAluno}else if("Professor"==usuario)return 0}function reSetObjetivo(a){{var c;$("#td_roteiro_squr_"+a).parent().attr("class").substring(8)}$.ajax({type:"GET",async:!1,crossDomain:!0,url:path+"PlanejamentoRoteiro/aluno/"+alunoID}).then(function(b){for(var d=0;d<b.length;d++)b[d].objetivo.idobjetivo==a&&(c=b[d].idplanejamentoRoteiro)})}function responderObservacao(a){localStorage.setItem("respostaObservacao",a),window.location.href="mensagens.html"}var userID=usuarioId,alunoID=getAlunoByUsuario(userID);if("Aluno"==usuario)var dataUsuario=getData("Usuario/aluno",alunoID),dataAlunoVariavel=getData("AlunoVariavel/aluno",alunoID);else var dataUsuario=0,dataAlunoVariavel=0;var dataObjetivo=getData("Objetivo",null),dataAtividade=getData("Atividade",null),dataProducaoAluno=getData("ProducaoAluno",null),dataPlanejamentoRoteiro=getData("PlanejamentoRoteiro/aluno",alunoID);if(dataPlanejamentoRoteiro.constructor!==Array){var aux=dataPlanejamentoRoteiro;dataPlanejamentoRoteiro=new Array(1),dataPlanejamentoRoteiro[0]=aux}if(dataAlunoVariavel.constructor!==Array){var aux=dataAlunoVariavel;dataAlunoVariavel=new Array(1),dataAlunoVariavel[0]=aux}var dataRecursoAprendizagem=getData("RecursoAprendizagem",null),alunoVariavelID=getAlunoVariavelByAluno(),AnoEstudoAno,PlanoEstudoSessionID=getData("PlanoEstudo/aluno",alunoID);if(0!=PlanoEstudoSessionID&&PlanoEstudoSessionID.constructor!==Array){var aux=PlanoEstudoSessionID;PlanoEstudoSessionID=new Array(1),PlanoEstudoSessionID[0]=aux}void 0!=PlanoEstudoSessionID[0]&&(PlanoEstudoSessionID=PlanoEstudoSessionID[0].idplanoEstudo);var PortifolioVariavel=0,roteiroAcionado=0,IdObjetivo=new Array,IdRoteiro=new Array,IdsRoteiroPendente=new Array;$(document).ready(function(){LoadRoteiro(),VerificaObjetivosCompletos(),0==PlanoEstudoSessionID&&"Aluno"==usuario&&mensagemF("Primeiro, precisa criar um Plano de Estudo","OK","bt_ok","alerta","redirect();"),GerarUpload($("#foto"),$("#Arquivo_Foto_Aluno"),$("#Dados_Foto_Aluno"))});
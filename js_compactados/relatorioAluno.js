function btnFechar(){$("#caixaRelatorio").css("display","none")}function listaObservacao(){var a,b=$("#tutoria").val(),c="";return $.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"RelatorioTutoria/RelatorioTutorAluno/"+b+"/"+alunoID,success:function(b){if(console.log(b),""!=b){$("#box_geral_observacao").css("display","block"),$("#observacao_box").css("padding-bottom","25px");for(var d=b.length-1;d>=0;d--){var e=b[d].data,f=e.split("-");e=f[2]+"/"+f[1]+"/"+f[0],c+='<div class="box_obs"><p class="titulo_obs"><span class="nome">'+b[d].tutoria.tutor.nome+'</span> | <span class="cargo">'+retornaPerfil(b[d].tutoria.tutor.idprofessorFuncionario)+'</span></span><span class="right">'+e+'</span></p><div class="vizu"><a href="#" onclick="mostrarAba(\''+b[d].idrelatorioTutoria+"')\">Visualizar</a></div></div>"}a=$("#observacoes").html(c)}}}),a}function retornaPerfil(a){var b;return $.ajax({url:path+"Usuario/professor/"+a,type:"GET",crossDomain:!0,dataType:"json",async:!1,success:function(a){b=a.perfil.perfil}}),b}function mostrarAba(a){var b=getData("RelatorioTutoria",a),c=getData("Usuario/professor",b.tutoria.tutor.idprofessorFuncionario),d=b.data,e=d.split("-");d=e[2]+"/"+e[1]+"/"+e[0];var f="width: 600px;height: 400px;background-color: #F2F2EE;position: absolute;margin: 0px 20%;top: 18%;border: 2px solid #FFFFFF;padding: 15px;",g="padding:0;margin:0;color:#878787;font-size:18px;",h="float:left;margin-right:5px",i="font-size:14px;",j="float:right;font-size:18px;margin-right:15px;",k="color:#878787;font-size:18px;height:98%; width: 98%; background-color: transparent; border: none; resize: none; color: #878787;margin-right: 10px;text-align:justify;",l="",l='<div class="boxRT" style="'+f+'"><p class="fechar"><a href="#" id="btnCancel" onclick="btnFechar()">X</a></p><p style="'+g+'"><span style="'+h+'">'+b.tutoria.tutor.nome+'</span> | <span style="'+i+'">'+c.perfil.perfil+'</span></span><span style="'+j+'">'+d+'</span></p><div class="scrollbar" id="ex3"><textarea style="'+k+'" id="texto"></textarea></div><p class="btnRT"><a href="#" id="btnPrint" onclick="imprimir()"></a></p><p class="btnTR"><a href="#" id="btnAtualizar" onclick="editarObservacao()">Salvar</a></p></div><input type="hidden" name="id" id="id" value="'+a+'" >';$("#caixaRelatorio").html(l).show(),$("#texto").html(b.relatorio),void 0==$("#aluno").val()&&$("#btnAtualizar").css("display","none")}function editarObservacao(){$.ajax({url:path+"RelatorioTutoria/",type:"POST",crossDomain:!0,dataType:"json",data:"relatorio="+$("#texto").val()+"&aluno="+$("#aluno").val()+"&action=update&tutoria="+$("#tutoria").val()+"&data="+$("#data").val()+"&id="+$("#id").val(),beforeSend:function(){loading("inicial")},success:function(){mensagem("Dados salvos com sucesso!","OK","bt_ok","sucesso")},complete:function(){loading("final")}})}function getPlanejamentoRoteiro(){var a;return $.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"PlanejamentoRoteiro/aluno/"+alunoID}).then(function(b){a=b}),a}function getRoteiros(){var a;return $.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Roteiro"}).then(function(b){a=b}),a}function getAluno(a){var b;return $.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Alunos/"+a}).then(function(a){b=a}),b}function graficoBarra(a){var c="";$.ajax({url:path+"PlanoEstudo/alunoTotal/"+a,async:!1,crossDomain:!0,type:"GET",success:function(a){for(var b=0;b<a.length;b++){var d=0,e=0;$.ajax({url:path+"PlanejamentoRoteiro/RoteirosAtivos/"+a[b].idplanoEstudo,async:!1,crossDomain:!0,type:"GET",success:function(a){for(var b=0;b<a.length;b++)1==a[b].status?d++:(2==a[b].status||3==a[b].status)&&(d++,e++)}});var f=d/20*100,g=e/20*100;c+='<div class="barra"><div class="col_barra"><p class="laranja barra_proposto" style="height:'+f+'%"></p><p class="verde barra_concluido" style="height:'+g+'%"></p></div><p class="dia_plano">'+a[b].dataInicio.substring(8,10)+"/"+a[b].dataInicio.substring(5,7)+"</p></div>"}}}),$(".box_mes").empty(),$(".box_mes").append(c)}function visualizarDados(){localStorage.setItem("alunoEdt",base64_decode(GetURLParameter("ID"))),$(location).attr("href","visualizarDados.html")}function getAnoLetivo(a){var c,b=new Date;if("idAnoLetivo"==a)for(var d=getData("AnoLetivo",null),e=0;e<d.length;e++){var f=d[e].ano;f=f.split("-"),f[0]==b.getUTCFullYear()&&(c=d[e].idanoLetivo)}else"anoAnoLetivo"==a&&(c=b.getUTCFullYear());return c}var usuarioID=usuarioId,alunoID=base64_decode(GetURLParameter("ID")),UsuarioAtivo=2,alunoIdCoded=GetURLParameter("ID"),dataPlanoEstudoAtual;$.ajax({url:path+"PlanoEstudo/aluno/"+alunoID,async:!1,crossDomain:!0,type:"GET",success:function(a){dataPlanoEstudoAtual=a}});var dataUsuario;$.ajax({url:path+"Usuario/"+usuarioID,async:!1,crossDomain:!0,type:"GET",success:function(a){dataUsuario=a}}),$(document).ready(function(){if(base64_decode(GetURLParameter("TU")))$("#tutoria").val(base64_decode(GetURLParameter("TU")));else{var a=new Date,b=a.getFullYear();$.ajax({url:path+"Tutoria/Professor/"+localStorage.getItem("professorId")+"/"+b,async:!1,crossDomain:!0,type:"GET",success:function(a){$("#tutoria").val(a[0].idtutoria)}})}1==confTutor&&$("#observacao_box").css("display","block");var l,m,c=-1,d=[],e=[],f=[],g="",h=[],i=0,j=0,k=0,n=getAluno(alunoID);$(".link_plano a").attr("href","planoDeEstudo.html?ID="+alunoIdCoded),$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"AlunoVariavel/aluno/"+alunoID}).then(function(a){c=a}),$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Roteiro/RoteiroAluno/"+alunoID+"/"+c.anoLetivo.ano}).then(function(a){roteiroExtra=a}),$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Roteiro/RoteiroAno/"+c.anoEstudo.idanoEstudo}).then(function(a){e=a});var o;$.ajax({url:path+"Objetivo/ObjetivoAluno/"+c.idalunoVariavel,async:!1,crossDomain:!0,type:"GET",success:function(a){o=a}}),console.log(o);for(var p=0;p<e.length;p++)f[f.length]=[],f[f.length-1][0]=e[p];for(var p=0;p<roteiroExtra.length;p++)f[f.length]=[],$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Roteiro/"+roteiroExtra[p].roteiro.idroteiro}).then(function(a){f[f.length-1][0]=a});d=getPlanejamentoRoteiro();for(var q=0;q<f.length;q++)objetivo="",$.ajax({type:"GET",crossDomain:!0,async:!1,url:path+"Objetivo/ObjetivoRoteiro/"+f[q][0].idroteiro}).then(function(a){if(a.length>0)for(var b=0;b<a.length;b++)h[0]=a[b],h[1]=0,f[q][parseInt(a[b].numero)]=a[b],f[q][parseInt(a[b].numero)]=h.slice()});for(var p=0;p<d.length;p++)for(var q=0;q<f.length;q++)d[p].objetivo.roteiro.nome==f[q][0].nome&&(f[q][d[p].objetivo.numero][1]=d[p].status,f[q][d[p].objetivo.numero][2]=d[p].idplanejamentoRoteiro,f[q][d[p].objetivo.numero][3]=d[p].objetivo.idobjetivo,f[q][d[p].objetivo.numero][4]=d[p].planoEstudo.idplanoEstudo);for(var p=0;p<f.length;p++){g+='<div class="linha_roteiro" id="'+f[p][0].idroteiro+'"> <p class="titulo"> '+f[p][0].nome+'</p> <table class="rot_aluno"><tr>',l=0,m=0;for(var s=1,q=1;q<f[p].length;q++)23==s&&(g+="</tr><tr>",s=1),s++,null!=f[p][q]&&(m++,k++,g+='<td id="'+f[p][q][2]+'" objid="'+f[p][q][3]+'" class= ',0==f[p][q][1]||1==f[p][q][1]&&f[p][q][4]!=dataPlanoEstudoAtual[0].idplanoEstudo?g+='"cinza">':1==f[p][q][1]&&f[p][q][4]==dataPlanoEstudoAtual[0].idplanoEstudo?g+='"laranja">':2==f[p][q][1]?(g+='"verde">',j++):3==f[p][q][1]&&(g+='"verde_tk">',l++,j++)),null!=f[p][q]&&(g+=f[p][q][0].numero+"</td>");l==m&&i++,g+="</tr> </table> </div>"}graficoBarra(alunoID,d),$("#res_roteiros").empty(),$("#res_roteiros").append('<span id="res_vermelho">'+i+"</span> roteiros de "+f.length+"</p>");var t=i/f.length*100,u=[{value:t,color:"#EB5B61",highlight:"#FF5A5E",label:"Red"},{value:100-t,color:"#C5C4B1",highlight:"#5AD3D1",label:"Green"}],v=document.getElementById("chart1").getContext("2d");window.myDoughnut=new Chart(v).Doughnut(u,{responsive:!0,showTooltips:!1,animation:!0}),$("#res_objetivos").empty(),$("#res_objetivos").append('<span id="res_azul">'+j+"</span> objetivos de "+o+"</p>");var w=j/k*100,x=[{value:w,color:"#4861AA",highlight:"#FF5A5E",label:"Red"},{value:100-w,color:"#C5C4B1",highlight:"#5AD3D1",label:"Green"}],v=document.getElementById("chart2").getContext("2d");window.myDoughnut=new Chart(v).Doughnut(x,{responsive:!0,showTooltips:!1,animation:!0});var y=presencaAluno(alunoID),z=y/180*100,A=[{value:z,color:"#FF7800",highlight:"#FF5A5E",label:"Red"},{value:100-z,color:"#C5C4B1",highlight:"#5AD3D1",label:"Green"}],v=document.getElementById("chart3").getContext("2d");window.myDoughnut=new Chart(v).Doughnut(A,{responsive:!0,showTooltips:!1,animation:!0}),$("#res_laranja").html(y);var B=diasLetivos();$("#letivos").html(B),$(".box_aluno_left").empty(),$(".box_aluno_left").append(g);for(var p=0;p<f.length;p++){var C;$.ajax({url:path+"Objetivo/ObjetivoRoteiroTotal/"+f[p][0].idroteiro,async:!1,crossDomain:!0,type:"GET",success:function(a){C=a}}),$("#"+f[p][0].idroteiro+" .verde_tk").length==C&&($("#"+f[p][0].idroteiro+" .verde_tk").remove(),$("#"+f[p][0].idroteiro+" tr").remove(),$("#"+f[p][0].idroteiro+" table").css("margin-top","13px"),$("#"+f[p][0].idroteiro+" tbody").append("<tr><td class='link_port'><a href='galeriaAluno.html?ID="+base64_encode(""+alunoID)+"'> Portf\xf3lio </a></td><tr>"))}$(".FotoAluno").html("<img src='"+n.fotoAluno+"' width='110' height='110'/>"),$(".nome_aluno").empty(),$(".nome_aluno").append(n.nome),$(".ano").empty(),$(".ano").append(c.anoEstudo.ano+"\xb0 ano"),$("#tutor_nome").empty(),$("#tutor_nome").append(null!=c.grupo.tutoria?c.grupo.tutoria.tutor.nome:"N\xe3o Atribuido"),l="";var D;$.ajax({url:path+"AlunoVariavel/grupo/"+c.grupo.idgrupo,async:!1,crossDomain:!0,type:"GET",success:function(a){D=a}});for(var p=0;p<D.length;p++)l+="<p>"+D[p].aluno.nome+"</p>";$(".alunos_grupo").empty(),$(".alunos_grupo").append(l);var E=getUrlVars();"coordenacao"==E.id&&($("#Cabecalho_Perfil_Area_Descricao").html("Jo\xe3o Ant\xf4nio"),$("#coord").html("\xc1rea da Coordena\xe7\xe3o"),$(".mudar").removeAttr("id"),$(".mudar").attr("id","Cabecalho_Perfil_Area_Foto_cood")),listaObservacao(),$("#aluno").val(alunoID);var a=new Date,F=a.getDate().toString().length<2?"0"+a.getDate():a.getDate(),G=a.getMonth()+1,b=a.getFullYear();$("#data").val(b+"-"+G+"-"+F),$("#btnSalvar").click(function(){var a=$("#observacao").val();""!=a?$.ajax({url:path+"RelatorioTutoria/",type:"POST",crossDomain:!0,dataType:"json",data:$("#obsRelatorio").serialize(),success:function(){mensagem("Dados salvos com sucesso!","OK","bt_ok","sucesso"),listaObservacao(),$("#observacao").val("")}}):mensagem("Por favor, preencha o campo de relat\xf3rio!","OK","bt_ok","erro")}),$("td.verde").click(function(){null!=dataUsuario.professor&&dataUsuario.professor.idprofessorFuncionario==c.grupo.tutoria.tutor.idprofessorFuncionario&&($(this).hasClass("verde")&&($(this).removeClass("verde").addClass("verde_tk"),$(this).css("color","rgba(255,255,255,0)")),$.ajax({url:path+"PlanejamentoRoteiro/",type:"POST",crossDomain:!0,dataType:"json",data:"id="+$(this).attr("id")+"&action=update&status=3&idAluno="+alunoID+"&objetivo="+$(this).attr("objid"),beforeSend:function(){loading("inicial")},error:function(){alert("N\xe3o modificado, verifique os campos.")},complete:function(){loading("final")}}))})});
function carregarProfessoresByPeriodo(b){professoresPeriodo=getData("Tutoria/TutoriaPerido",b),$("#tutoria").html("");var c="";for(a=0;a<professoresPeriodo.length;a++)c+="<option value='"+professoresPeriodo[a].tutor.idprofessorFuncionario+"'>"+professoresPeriodo[a].tutor.nome+"</option>";$("#tutoria").html(c)}function MostrarGrupos(){var a=dataGrupos.length;$("#box_grupo_info").html("");for(var b=0;b<a;b++)if(1!=dataGrupos[b].status&&($(".tutoriaT").val()==dataGrupos[b].tutoria.idtutoria||"Todas"==$(".tutoriaT").val())&&(dataAlunosGrupo=getData("AlunoVariavel/grupo",dataGrupos[b].idgrupo),dataAlunosGrupo.length>0)){HtmlContent='<div class="boxGrupo'+dataAlunosGrupo[0].grupo.idgrupo+' linha" id="'+dataAlunosGrupo[0].grupo.idgrupo+'">',HtmlContent+='<div class="grupoCaixa">',HtmlContent+='<div class="grupoTitulo">'+dataAlunosGrupo[0].grupo.nomeGrupo+"</div>",HtmlContent+='<div class="Aluno_Grupo nomes'+dataAlunosGrupo[0].grupo.idgrupo+'"><span class="titulo">Alunos:</span>';for(var c=0;c<dataAlunosGrupo.length;c++)HtmlContent+=0!=c?", "+dataAlunosGrupo[c].aluno.nome:dataAlunosGrupo[c].aluno.nome;HtmlContent+="</div>",HtmlContent+='<div class="tutor"> Tutor:</div>',HtmlContent+='<div class="tutor_nome">'+(null!=dataAlunosGrupo[0].grupo.tutoria?dataAlunosGrupo[0].grupo.tutoria.tutor.nome:"N\xe3o Atribuido")+"</div>",HtmlContent+="</div>",HtmlContent+='<div class="btEditar" onclick="montagemEdicao('+dataAlunosGrupo[0].grupo.idgrupo+');"></div>',HtmlContent+='<div class="btExcluir" onclick="montagemExclusao('+dataAlunosGrupo[0].grupo.idgrupo+');"></div>',HtmlContent+="</div>",$("#box_grupo_info").append(HtmlContent)}return!1}function grupoNovo(){var g,a=$("#S_AnoEstudo option:selected").text(),b=$("#S_Periodo option:selected").text(),c=$("#S_Periodo").val(),d=$("#tutoria").val(),e=$(".S_Aluno"),f=!1;a=a.substring(0,1),b=b.substring(0,1);for(var h=0;h<e.length;h++)"-1"!=$("#"+e[h].id).val()?f=!0:g="Escolha pelo menos um aluno!";"-1"==d&&(g="Escolha um tutor!"),"-1"!=d&&1==f?$.ajax({url:path+"Grupo/",type:"POST",async:!1,crossDomain:!0,dataType:"json",contentType:!1,beforeSend:function(){loading("inicial")},data:"action=create&status=0&anoEstudo="+a+"&periodo="+b+"&idProfessor="+d+"&lider=0&id=0&idPeriodo="+c,success:function(a){loading("inicial");for(var b="",c=new Array,d=0,f=0;f<e.length;f++)""!=$("#"+e[f].id).val()&&"-1"!=$("#"+e[f].id).val()&&(c[d]=$("#"+e[f].id).val(),d++);for(var g=0;g<c.length;g++)b+=g==c.length-1?c[g]:c[g]+";";$.ajax({url:path+"AlunoVariavel/alunoGrupo/",type:"POST",async:!1,crossDomain:!0,dataType:"json",contentType:!1,data:"action=update&alunos="+b+"&grupo="+a,success:function(){dataGrupos=getData("Grupo",null);var b=$(".S_Aluno");b.val(b.find('option[value="-1"]').val());var c=$(".tutoria");c.val(c.find('option[value="Todas"]').val()),MostrarGrupos(),mensagem("Grupo cadastrado com sucesso!","OK","bt_ok","sucesso")}})},complete:function(){loading("final")}}):(mensagem(g,"OK","bt_ok","alerta"),loading("final"))}function montagemEdicao(a){var b=$("#periodo").val();$("#S_Periodo option[value='"+b+"']").attr("selected","true"),$("#bt_Pesquisar").removeClass("bt_Pesquisar_Ativo"),$("#container_Pesquisa").css("display","none"),$("#bt_Inserir").addClass("bt_Inserir_Ativo_Grupo"),$("#container_Inserir").css("display","block"),$("#editarGrupo").css("display","block"),$("#cadastrarGrupo").css("display","none"),$("#action").val("update"),$("#grupo").val(a);var c;$.ajax({url:path+"Grupo/AlunoGrupo/"+a,async:!1,crossDomain:!0,type:"GET",success:function(a){c=a}}),$("#S_AnoEstudo option[value='"+c[0].anoEstudo.idanoEstudo+"']").attr("selected","true");for(var d=0;d<c.length||d<$(".S_Aluno").length;d++)d>=$(".S_Aluno").length&&$("#btAdd").trigger("click"),d<c.length?alimentaComboAluno("S_Aluno"+(d+1),c[d]):alimentaCombo("S_Aluno"+(d+1));var e=c[0].grupo.tutoria.tutor.idprofessorFuncionario;$("#tutoria option[value='"+e+"']").attr("selected","true")}function alimentaCombo(a){$("#"+a).html(""),$.ajax({url:path+"AlunoVariavel/html/"+$("#S_AnoEstudo").val()+"/"+$("#S_Periodo").val(),dataType:"html",success:function(b){$("#"+a).html("<option value=-1></option>"+b)}})}function alimentaComboAluno(a,b){$("#"+a).html(""),$.ajax({url:path+"AlunoVariavel/html/"+b.anoEstudo.idanoEstudo+"/"+b.periodo.idperiodo,dataType:"html",success:function(c){$("#"+a).html("<option value=-1></option>"+c+"<option value="+b.idalunoVariavel+" selected>"+b.aluno.nome+"</option>")}})}function montagemExclusao(a){for(var b="",c=0,d=0;d<dataAlunoVariavel.length;d++)null!=dataAlunoVariavel[d].grupo&&dataAlunoVariavel[d].grupo.idgrupo==a&&(b+=0==c?dataAlunoVariavel[d].idalunoVariavel:";"+dataAlunoVariavel[d].idalunoVariavel,c++);return $.ajax({url:path+"Grupo",type:"POST",async:!1,crossDomain:!0,dataType:"json",contentType:!1,data:"action=delete&idGrupo="+a,success:function(){return $("#"+a).remove(),mensagem("Exclu\xeddo com sucesso!","OK","bt_ok","success"),$("#S_AnoEstudo").trigger("change"),!1},error:function(){return mensagem("Erro ao excluir!","OK","bt_ok","erro"),console.log("Erro ao excluir grupo")}}),!1}function editarGrupoFun(){loading("inicial");var a=$("#grupo").val(),e=(new Array,new Array),f=0,g="",h=!1;if($(".S_Aluno").each(function(){"-1"!=$(this).val()&&(h=!0)}),0==h)return mensagem("Escolha pelo menos um aluno!","OK","bt_ok","erro"),loading("final"),!1;$("#S_AnoEstudo").attr("disabled",!1),$("#S_Periodo").attr("disabled",!1);var i=getData("Grupo",a),j="";j=null!=i.lider?i.lider.idAluno:0;var k=$("#S_AnoEstudo option:selected").text(),l=$("#S_Periodo option:selected").text(),n=($("#S_Periodo").val(),$("#tutoria").val());k=k.substring(0,1),l=l.substring(0,1),$.ajax({url:path+"Grupo/",type:"POST",async:!1,crossDomain:!0,dataType:"json",contentType:!1,data:"action=update&id="+a+"&anoEstudo="+k+"&periodo="+l+"&idProfessor="+n+"&tutoria="+g+"&lider="+j,success:function(){for(var c=$(".S_Aluno"),d="",g=0;g<c.length;g++)""!=$("#"+c[g].id).val()&&"-1"!=$("#"+c[g].id).val()&&(e[f]=$("#"+c[g].id).val(),f++);for(var h=0;h<e.length;h++)d+=h==e.length-1?e[h]:e[h]+";";$.ajax({url:path+"AlunoVariavel/alunoGrupo/",type:"POST",async:!1,crossDomain:!0,dataType:"json",contentType:!1,data:"alunos="+d+"&grupo="+a,success:function(){dataTutoria=getData("Tutoria",null);var b=$("#anoEstudo");b.val(b.find("option").eq(0).val());var c=$("#periodo");c.val(c.find('option[value="8"]').val());var d=$("#tutoriaT");d.val(d.find('option[value="Todas"]').val());var e=$(".S_Aluno");e.val(e.find("option").eq(0).val());var d=$(".tutoria");d.val(d.find('option[value="Todas"]').val()),$("#box_grupo_info").html(""),MostrarGrupos(),mensagem("Grupo editado com sucesso!","OK","bt_ok","sucesso"),loading("final")},error:function(){console.log("Erro update dos alunos"),loading("final")}})},error:function(){console.log("Erro update no nome do grupo"),loading("final")}})}var alunoID=2,UsuarioAtivo=2,dataTutoria=getData("Tutoria",null),dataProfessorFuncionario=getData("ProfessorFuncionario",null),dataAlunoVariavel=getData("AlunoVariavel",null),dataPeriodo=getData("Periodo",null),dataAnoEstudo=getData("AnoEstudo",null),dataGrupos=getData("Grupo",null);$(document).ready(function(){for(var a=dataAnoEstudo.length,b="",c=0;c<a;c++)b+='<option value="'+dataAnoEstudo[c].ano+'">'+dataAnoEstudo[c].ano+"\xba</option>";$("#anoEstudo").html(b);var a=dataTutoria.length,b="";b+='<option value="Todas">Todas</option>';for(var c=0;c<a;c++)b+='<option value="'+dataTutoria[c].idtutoria+'">'+dataTutoria[c].tutor.nome+"</option>";b+='<option value="N_A">N\xe3o Atribuido</option>',$(".tutoriaT").html(b),MostrarGrupos(),carregarProfessoresByPeriodo("8"),$("#anoEstudo").change(function(){MostrarGrupos()}),$("#S_Periodo").change(function(){carregarProfessoresByPeriodo($("#S_Periodo").val())}),$(".tutoriaT").change(function(){MostrarGrupos()}),$("body").delegate(".bt_Inserir_Ativo_Grupo","click",function(){$("#editarGrupo").hide(),$("#cadastrarGrupo").show(),"8"==$("#S_Periodo").val()?$("#tutoria option").eq(0).attr("selected","selected"):($("#S_Periodo option").eq(0).attr("selected","selected"),carregarProfessoresByPeriodo("8")),Linha=3,$(".S_Aluno").each(function(){id=$(this).attr("id"),Linha<8?$("#"+id+" option").eq(0).attr("selected","selected"):$("#linha"+Linha).remove(),Linha+=1}),$("#S_AnoEstudo option").eq(0).val()!=$("#S_AnoEstudo").val()&&($("#S_AnoEstudo option").eq(0).attr("selected","selected"),SetValoresAlunoVariavel())})});